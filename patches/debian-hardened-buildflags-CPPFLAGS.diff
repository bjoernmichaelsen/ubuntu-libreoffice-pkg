From d87d074aa27a2eb565fabc6e502edf6fc758bbfd Mon Sep 17 00:00:00 2001
From: Debian LibreOffice Maintainers <debian-openoffice@lists.debian.org>
Date: Sat, 9 Nov 2013 02:00:34 +0100
Subject: [PATCH] debian-hardened-buildflags-CPPFLAGS.diff

Change-Id: I2ba4dc925a66ecca5c7cc4af87224511a3bc88d9
---
 config_host.mk.in       | 1 +
 configure.ac            | 5 +++++
 solenv/gbuild/gbuild.mk | 2 ++
 3 files changed, 8 insertions(+)

diff --git a/config_host.mk.in b/config_host.mk.in
index d14beb7..26ab784 100644
--- a/config_host.mk.in
+++ b/config_host.mk.in
@@ -71,6 +71,7 @@ export CPPUNIT_LIBS=$(gb_SPACE)@CPPUNIT_LIBS@
 export CPU=@CPU@
 export CPUNAME=@CPUNAME@
 export CDEFAULTOPT=@CDEFAULTOPT@
+export HARDEN_CPPFLAGS=@HARDEN_CPPFLAGS@
 export CROSS_COMPILING=@CROSS_COMPILING@
 export CURL=@CURL@
 export CURL_CFLAGS=$(gb_SPACE)@CURL_CFLAGS@
diff --git a/configure.ac b/configure.ac
index a664efb..8b1b92a 100755
--- a/configure.ac
+++ b/configure.ac
@@ -10255,6 +10255,11 @@ else
 fi
 AC_SUBST(ENABLE_VLC)
 
+if test -x /usr/bin/dpkg-buildflags; then
+	HARDEN_CPPFLAGS=`dpkg-buildflags --get CPPFLAGS 2>/dev/null`
+fi
+AC_SUBST(HARDEN_CPPFLAGS)
+
 dnl ===================================================================
 dnl Check whether the OpenGL libraries are available
 dnl ===================================================================
--- a/config_host.mk.in-old	2012-04-06 14:17:55.164239390 +0200
+++ b/config_host.mk.in	2012-04-06 14:18:55.440239065 +0200
@@ -70,6 +70,7 @@
 export CPPUNIT_LIBS=$(gb_SPACE)@CPPUNIT_LIBS@
 export CPUNAME=@CPUNAME@
 export CDEFAULTOPT=@CDEFAULTOPT@
+export HARDEN_CPPFLAGS=@HARDEN_CPPFLAGS@
 export CROSS_COMPILING=@CROSS_COMPILING@
 export CURL=@CURL@
 export CURL_CFLAGS=$(gb_SPACE)@CURL_CFLAGS@
diff --git a/solenv/gbuild/gbuild.mk b/solenv/gbuild/gbuild.mk
index 11f9bf4..86478bb 100644
--- a/solenv/gbuild/gbuild.mk
+++ b/solenv/gbuild/gbuild.mk
@@ -257,6 +257,8 @@ gb_GLOBALDEFS += \
 		ENABLE_LTO \
 	)
 
+gb_GLOBALDEFS += $(HARDEN_CPPFLAGS)
+
 gb_GLOBALDEFS := $(sort $(gb_GLOBALDEFS))
 
 gb_USER_INSTALLATION = $(call gb_Helper_make_url,$(TESTINSTALLDIR)/)
-- 
1.8.3.2

